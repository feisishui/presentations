/**
 * Copyright @ 2016 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/_base/lang","dojo/_base/declare","dojo/Deferred","dojo/text!./PointExtrudeMaterial.xml","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(i,t,r,e,s,a,o){var n=t(null,{declaredClass:"esri.views.3d.effects.PointExtrude.PointExtrudeMaterial",constructor:function(i){this._gl=i.gl,this._vbLayout=i.vbLayout,this._shaderSnippets=i.shaderSnippets,this._program=null},update:function(i){},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},loadShaders:function(){if(this._shaderSnippets){(null==this._shaderSnippets.pointExtrudeVS||null==this._shaderSnippets.pointExtrudeFS)&&this._shaderSnippets._parse(e);var i=new s(this._gl.VERTEX_SHADER,this._shaderSnippets.pointExtrudeVS,this._gl),t=new s(this._gl.FRAGMENT_SHADER,this._shaderSnippets.pointExtrudeFS,this._gl);this._program=new a([i,t],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(i){o.debug_clearEarth&&this._gl.clear(this._gl.COLOR_BUFFER_BIT),this._program.use(),this._program.uniformMatrix4fv("projMat",i.proj),this._program.uniformMatrix4fv("viewMat",i.view),this._program.uniform1f("earthRadius",i.earthRadius),this._program.uniform3fv("camPos",i.camPos),this._program.uniform3fv("lightDirection",i.lightingData.direction),this._program.uniform4fv("lightAmbient",i.lightingData.ambient),this._program.uniform4fv("lightDiffuse",i.lightingData.diffuse),this._program.uniform4fv("lightSpecular",i.lightingData.specular),i.startVizFieldVertexture.bind(0),this._program.uniform1i("startVizFieldVertexture",0),i.endVizFieldVertexture.bind(1),this._program.uniform1i("endVizFieldVertexture",1),this._program.uniform2fv("vizFieldVertextureSize",i.vizFieldVertextureSize),this._program.uniform2fv("wholeMinMaxValue",[i.minValue,i.maxValue]),this._program.uniform2fv("size",i.size),this._program.uniform1f("animationInterval",i.animationInterval),this._program.uniform1f("transparency",i.transparency),this._program.uniform1f("topColor",i.topColor),this._program.uniform1f("bottomColor",i.bottomColor),this._program.uniform1f("fxTime",i.time),this._program.uniform1i("reachedRepeatLimit",i.reachedRepeatLimit),this._program.uniform1f("segmentsFactor",i.segmentsFactor),this._gl.enable(this._gl.DEPTH_TEST),this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.BLEND),this._vbLayout.enableVertexAttribArrays(this._gl,this._program,!1)},release:function(){this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.disable(this._gl.CULL_FACE),this._gl.disable(this._gl.BLEND),this._vbLayout.disableVertexAttribArrays(this._gl,this._program,!1),this._gl.useProgram(null)}});return n});